language: python

python:
  - "3.6"

before_install:
  - python --version
  - pip install -U pip
  - pip install -U pytest
  - pip install -U black

install:
  - pip install ".[test]" .

jobs:
  include:
    - stage: run unit tests
      python: 3.6
      script: pytest
    - stage: test black code formatting
      python: 3.6
      script: black --check pytmg/
    - stage: pypi release
      python: 3.6
      script: echo "Deploying to PyPI..."
      deploy:
        - provider: pypi
          distributions: sdist
          server: https://upload.pypi.org/legacy/
          user: $PYPI_USERNAME
          password: $PYPI_PASSWORD
          on:
            branch: master
            tags: true